{% if tasks %}
{% set totalTasks = tasks|length %}
{% set todoTasks = tasks|filter(task => task.status != 1) %}
{% set doneTasks = tasks|filter(task => task.status == 1) %}
{% set doneTasksCount = doneTasks|length %}

<div class="bg-stone-300" style="max-height: calc(100vh - 232px);">
    <div class="gridbg" style="max-height: calc(100vh - 232px);">
        <div class="box" style="max-height: calc(100vh - 232px);">
            <div id="scrollbar-container" class="w-full overflow-auto" style="height: calc(100vh - 232px);">
                <div id="task-container" class="task-container flex justify-center" style="min-height: calc(100vh - 232px);">
                    <div id="taskList" class="task-list pt-10 w-3/6 flex flex-col">

                    {% if totalTasks == 0 %}
                        <h2 class="mb-4 text-3xl font-extrabold text-gray-900 dark:text-white"><span class="text-transparent bg-clip-text bg-gradient-to-r to-primary from-highlight text-center">No tasks yet</span></h2>
                        <p class="mb-4 text-md font-bold text-gray-900 dark:text-white"><span class="text-black text-center">Add a task to get started with the + button at the top of the page</span></p>
                    {% endif %}
                    {% if todoTasks|length > 0 %}
                    <h1 class="mb-4 text-3xl font-extrabold text-gray-900 dark:text-white"><span class="text-transparent bg-clip-text bg-gradient-to-r to-primary from-highlight">To Do: </span></h1>
                        {% if doneTasks|length > 0 %}
                        <div class="progress-bar border border-black w-full bg-gray-300 rounded mb-4">
                            <div class="bg-gradient-to-r to-primary from-highlight text-xs leading-none text-center text-white rounded" style="width: {{ (doneTasksCount / totalTasks) * 100 }}%">
                                {{ (doneTasksCount) }} / {{ (totalTasks) }}
                            </div>
                        </div>
                        {% endif %}
                        {% for task in todoTasks %}
                            {% include 'home/taskElement.html.twig' %}
                        {% endfor %}
                    {% endif %}

                        {% if doneTasks|length > 0 %}
                        <h1 class="mb-4 text-3xl font-extrabold text-gray-900 dark:text-white"><span class="text-transparent bg-clip-text bg-gradient-to-r to-primary from-highlight">Done: </span></h1>
                        {% for task in doneTasks %}
                            {% include 'home/taskElement.html.twig' %}
                        {% endfor %}
                    {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% block stylesheets %}
    {{ encore_entry_link_tags('checkbutton') }}
    {{ encore_entry_link_tags('star') }}
    {{ encore_entry_link_tags('tasksBackground') }}
    {{ encore_entry_link_tags('scrollbar') }}
{% endblock %}

<script>
function toggleDropdownMenu(event) {
    event.stopPropagation();
var dropdownItems = event.currentTarget.parentNode.getElementsByClassName('dropdownItems')[0];
        dropdownItems.classList.toggle('invisible');
}

document.addEventListener('click', function(event) {
    var dropdownMenus = document.getElementsByClassName('dropdownMenu');
    for (var i = 0; i < dropdownMenus.length; i++) {
        var dropdownItems = dropdownMenus[i].getElementsByClassName('dropdownItems')[0];
        var isClickInside = dropdownMenus[i].contains(event.target);
        if (!isClickInside) {
            dropdownItems.classList.add('invisible');
        }
    }
});
</script>

<style>
.gridbg {
  background-image: linear-gradient(#b5b5b5 1px, transparent 1px),
    linear-gradient(to right, #b5b5b5 1px, transparent 1px);
  background-size: 100px 100px;
}

.box {
  display: grid;
  background: radial-gradient(transparent, #ffffff 95%);
  height: 100vh;
}
</style>

{% if tasks %}
{% set totalTasks = tasks|length %}
{% set todoTasks = tasks|filter(task => task.status != 1) %}
{% set doneTasks = tasks|filter(task => task.status == 1) %}
{% set doneTasksCount = doneTasks|length %}

<div id="scrollbar-container" class="w-full overflow-auto" style="height: calc(100vh - 268px);">
    <div id="task-container" class="task-container flex justify-center" style="min-height: calc(100vh - 268px);">
        <div id="taskList" class="task-list pt-10 w-3/6 flex flex-col">

        {% if totalTasks == 0 %}
            <h2 class="mb-4 text-3xl font-extrabold text-gray-900 dark:text-white"><span class="text-transparent bg-clip-text bg-gradient-to-r to-primary from-highlight text-center">No tasks yet</span></h2>
            <p class="mb-4 text-md font-bold text-gray-900 dark:text-white"><span class="text-black text-center">Add a task to get started with the + button at the top of the page</span></p>
        {% endif %}
        {% if todoTasks|length > 0 %}
        <h1 class="mb-4 text-3xl font-extrabold text-gray-900 dark:text-white"><span class="text-transparent bg-clip-text bg-gradient-to-r to-primary from-highlight">To Do: </span></h1>
            {% if doneTasks|length > 0 %}
            <div class="progress-bar w-full bg-gray-300 rounded mb-4">
                <div class="bg-gradient-to-r to-primary from-highlight text-xs leading-none text-center text-white rounded" style="width: {{ (doneTasksCount / totalTasks) * 100 }}%">
                    {{ (doneTasksCount) }} / {{ (totalTasks) }}
                </div>
            </div>
            {% endif %}
            {% for task in todoTasks %}
                {% include 'home/taskElement.html.twig' %}
            {% endfor %}
        {% endif %}

            {% if doneTasks|length > 0 %}
            <h1 class="mb-4 text-3xl font-extrabold text-gray-900 dark:text-white"><span class="text-transparent bg-clip-text bg-gradient-to-r to-primary from-highlight">Done: </span></h1>
            {% for task in doneTasks %}
                {% include 'home/taskElement.html.twig' %}
            {% endfor %}
        {% endif %}
        </div>
    </div>
</div>
{% endif %}

{% block stylesheets %}
    {{ encore_entry_link_tags('checkbutton') }}
    {{ encore_entry_link_tags('star') }}
    {{ encore_entry_link_tags('tasksBackground') }}
    {{ encore_entry_link_tags('scrollbar') }}
{% endblock %}

<script>
function toggleDropdownMenu(event) {
    event.stopPropagation();
var dropdownItems = event.currentTarget.parentNode.getElementsByClassName('dropdownItems')[0];
        dropdownItems.classList.toggle('invisible');
}

document.addEventListener('click', function(event) {
    var dropdownMenus = document.getElementsByClassName('dropdownMenu');
    for (var i = 0; i < dropdownMenus.length; i++) {
        var dropdownItems = dropdownMenus[i].getElementsByClassName('dropdownItems')[0];
        var isClickInside = dropdownMenus[i].contains(event.target);
        if (!isClickInside) {
            dropdownItems.classList.add('invisible');
        }
    }
});
</script>